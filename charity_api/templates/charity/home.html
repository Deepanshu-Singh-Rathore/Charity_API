{% extends 'charity/base.html' %}

{% block title %}Home - Charity Hub{% endblock %}

{% block content %}
<section class="hero">
    <h1><i class="fas fa-heart"></i> Empowering Change Together</h1>
    <p>Join us in making a difference in the lives of those who need it most</p>
    <a href="/campaigns/" class="btn">Explore Campaigns</a>
</section>

<div class="container">
    <div class="stats">
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-building"></i>
                <h3 id="org-count">0</h3>
                <p>Active Organizations</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-bullhorn"></i>
                <h3 id="campaign-count">0</h3>
                <p>Active Campaigns</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <h3 id="beneficiary-count">0</h3>
                <p>Beneficiaries Helped</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-dollar-sign"></i>
                <h3 id="total-raised">$0</h3>
                <p>Total Funds Raised</p>
            </div>
        </div>
    </div>

    <div class="section-title">
        <h2>Featured Campaigns</h2>
        <p>Support these ongoing initiatives making a real impact</p>
    </div>

    <div id="campaigns-loading" class="loading">
        <div class="spinner"></div>
        <p>Loading campaigns...</p>
    </div>

    <div id="campaigns-grid" class="card-grid" style="display: none;"></div>

    <div style="text-align: center; margin-top: 3rem;">
        <a href="/campaigns/" class="btn btn-primary">View All Campaigns</a>
    </div>
</div>

<div class="container">
    <div class="section-title">
        <h2>Our Partner Organizations</h2>
        <p>Trusted organizations working to create positive change</p>
    </div>

    <div id="orgs-loading" class="loading">
        <div class="spinner"></div>
        <p>Loading organizations...</p>
    </div>

    <div id="orgs-grid" class="card-grid" style="display: none;"></div>

    <div style="text-align: center; margin-top: 3rem;">
        <a href="/organizations/" class="btn btn-secondary">View All Organizations</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Load stats
    $.get('/api/organizations/', function(data) {
        $('#org-count').text(data.count || 0);
    });

    $.get('/api/campaigns/active/', function(data) {
        $('#campaign-count').text(data.count || 0);
        
        // Calculate total raised
        let totalRaised = 0;
        if (data.results) {
            data.results.forEach(campaign => {
                totalRaised += parseFloat(campaign.raised_amount || 0);
            });
        }
        $('#total-raised').text('$' + totalRaised.toLocaleString());
    });

    $.get('/api/beneficiaries/', function(data) {
        $('#beneficiary-count').text(data.count || 0);
    });

    // Load featured campaigns (active campaigns, limit 3)
    $.get('/api/campaigns/active/', function(data) {
        $('#campaigns-loading').hide();
        $('#campaigns-grid').show();
        
        const campaigns = data.results ? data.results.slice(0, 3) : [];
        
        if (campaigns.length === 0) {
            $('#campaigns-grid').html('<p style="text-align: center; color: #666;">No active campaigns at the moment.</p>');
            return;
        }

        campaigns.forEach(campaign => {
            const progress = ((campaign.raised_amount / campaign.goal_amount) * 100).toFixed(1);
            const statusClass = campaign.status === 'active' ? 'success' : 
                              campaign.status === 'completed' ? 'info' : 
                              campaign.status === 'planning' ? 'warning' : 'danger';
            
            const card = `
                <div class="card campaign-card">
                    <div class="card-header">
                        <h3>${campaign.title}</h3>
                        <span class="badge badge-${statusClass}">${campaign.status.toUpperCase()}</span>
                    </div>
                    <div class="card-body">
                        <p><i class="fas fa-building"></i> ${campaign.organization_name}</p>
                        <p>${campaign.description.substring(0, 120)}...</p>
                        ${campaign.location ? `<p><i class="fas fa-map-marker-alt"></i> ${campaign.location}</p>` : ''}
                        
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        
                        <div class="campaign-stats">
                            <div class="stat">
                                <div class="stat-value">$${parseFloat(campaign.raised_amount).toLocaleString()}</div>
                                <div class="stat-label">Raised</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">$${parseFloat(campaign.goal_amount).toLocaleString()}</div>
                                <div class="stat-label">Goal</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${progress}%</div>
                                <div class="stat-label">Progress</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <p><i class="far fa-calendar"></i> ${campaign.start_date} to ${campaign.end_date}</p>
                        <p><i class="fas fa-users"></i> ${campaign.beneficiary_count} beneficiaries</p>
                    </div>
                </div>
            `;
            $('#campaigns-grid').append(card);
        });
    });

    // Load featured organizations (limit 3)
    $.get('/api/organizations/active/', function(data) {
        $('#orgs-loading').hide();
        $('#orgs-grid').show();
        
        const orgs = data.results ? data.results.slice(0, 3) : [];
        
        if (orgs.length === 0) {
            $('#orgs-grid').html('<p style="text-align: center; color: #666;">No organizations available.</p>');
            return;
        }

        orgs.forEach(org => {
            const card = `
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-building"></i> ${org.name}</h3>
                        ${org.is_active ? '<span class="badge badge-success">ACTIVE</span>' : '<span class="badge badge-danger">INACTIVE</span>'}
                    </div>
                    <div class="card-body">
                        <p>${org.description.substring(0, 150)}...</p>
                        <p><i class="fas fa-envelope"></i> ${org.email}</p>
                        ${org.phone ? `<p><i class="fas fa-phone"></i> ${org.phone}</p>` : ''}
                        ${org.website ? `<p><i class="fas fa-globe"></i> <a href="${org.website}" target="_blank">Visit Website</a></p>` : ''}
                    </div>
                    <div class="card-footer">
                        <p><i class="fas fa-bullhorn"></i> ${org.campaign_count} campaigns</p>
                        ${org.established_date ? `<p><i class="far fa-calendar"></i> Established ${org.established_date}</p>` : ''}
                    </div>
                </div>
            `;
            $('#orgs-grid').append(card);
        });
    });
});
</script>
{% endblock %}
